<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SACCO Staff - TekeTeke Go</title>
  <link rel="manifest" href="./manifest.json"/>
  <link rel="stylesheet" href="/public/mobile/theme.css"/>
  <script src="/public/js/app-config.js"></script>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:linear-gradient(180deg,#e0f2fe 0,#f9fafb 36%,#ffffff 100%);
      color:#0f172a;
    }
    .sacco-staff-app{
      max-width:480px;
      margin:0 auto;
      padding:16px 12px 24px;
    }
    .hero-card{
      border-radius:32px;
      padding:20px 18px 24px;
      background:linear-gradient(135deg,#0ea5e9,#0284c7);
      color:#f9fafb;
      box-shadow:0 26px 60px rgba(15,23,42,.45);
      margin-bottom:18px;
    }
    .hero-eyebrow{
      margin:0 0 4px;
      font-size:13px;
      opacity:.9;
    }
    .hero-title{
      margin:0;
      font-size:22px;
      font-weight:750;
    }
    .hero-subtitle{
      margin:4px 0 16px;
      font-size:13px;
      opacity:.9;
    }
    .hero-actions{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .hero-pill,
    .hero-logout{
      border-radius:999px;
      padding:10px 16px;
      border:none;
      font-weight:650;
      font-size:14px;
    }
    .hero-pill{
      background:#f9fafb;
      color:#0369a1;
      box-shadow:0 12px 30px rgba(15,23,42,.3);
    }
    .hero-pill.ghost{
      background:transparent;
      color:#e0f2fe;
      border:1px solid rgba(241,245,249,.7);
      box-shadow:none;
    }
    .hero-logout{
      margin-top:4px;
      background:#b91c1c;
      color:#fff;
      box-shadow:0 16px 40px rgba(148,27,37,.7);
    }
    .ss-today{
      border-radius:26px;
      padding:14px 12px 18px;
      background:linear-gradient(180deg,#eff6ff 0,#ffffff 90%);
      box-shadow:0 22px 45px rgba(15,23,42,.18);
    }
    .ss-today-header{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 18px;
      border-radius:999px;
      background:linear-gradient(135deg,#0ea5e9,#0284c7);
      color:#f9fafb;
      font-weight:700;
      font-size:15px;
      margin-bottom:12px;
    }
    .ss-today-body{
      border-radius:22px;
      padding:10px;
      background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(241,245,249,.96));
      box-shadow:0 18px 40px rgba(148,163,184,.25) inset;
    }
    .two-col-section h4{
      margin:0 0 6px;
      font-size:13px;
      font-weight:650;
      color:#0f172a;
    }
  </style>
</head>
<body>
  <div class="app sacco-staff-app">
    <section class="hero-card">
      <p class="hero-eyebrow">SACCO Staff Console</p>
      <h1 class="hero-title" id="ss_title">Hello, Demo staff</h1>
      <p class="hero-subtitle" id="ss_time">Today</p>
      <div class="hero-actions">
        <button class="hero-pill" type="button">Role Select</button>
        <div class="hero-pill ghost" id="ss_signed">Signed in (demo)</div>
        <button class="hero-logout" type="button">Logout</button>
      </div>
    </section>

    <section class="ss-today">
      <div class="ss-today-header">Today</div>
      <div class="ss-today-body">
        <div class="two-col">
          <section class="two-col-section">
            <h4>Matatus</h4>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Plate</th><th>Type</th></tr></thead>
                <tbody id="list"></tbody>
              </table>
            </div>
          </section>

          <section class="two-col-section">
            <h4>Fees (today)</h4>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Time</th><th>Matatu</th><th>Amount</th></tr></thead>
                <tbody id="fees"></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>
    </section>
  </div>

  <script type="module">
    const el = (id) => document.getElementById(id);
    const demo = Boolean(window.TT_DEMO);
    try{
      const now = new Date();
      const pretty = now.toLocaleString('en-KE', { dateStyle:'medium', timeStyle:'short' });
      const t = el('ss_time');
      if (t) t.textContent = pretty;
    }catch(_){}

    if (demo){
      const mats = [
        { number_plate:'KAA 123A', vehicle_type:'14-seater' },
        { number_plate:'KBB 456B', vehicle_type:'33-seater' }
      ];
      el('list').innerHTML = (mats || []).map(x => `
        <tr>
          <td>${x.number_plate}</td>
          <td>${x.vehicle_type}</td>
        </tr>
      `).join('');

      const fees = [
        { created_at:'2025-11-19T08:15:00Z', matatu_id:'KAA 123A', amount:'500' },
        { created_at:'2025-11-19T09:05:00Z', matatu_id:'KBB 456B', amount:'700' }
      ];
      el('fees').innerHTML = fees.map(x => `
        <tr>
          <td>${(x.created_at || '').slice(11,19)}</td>
          <td>${x.matatu_id}</td>
          <td>${x.amount}</td>
        </tr>
      `).join('');
    }else{
      const { ensureAuth, authFetch, mountServiceWorker } = await import('/public/mobile/shared/core.js');
      await ensureAuth();
      mountServiceWorker();

      const mats = await authFetch('/u/vehicles');
      el('list').innerHTML = (mats.items || []).map(x => `
        <tr>
          <td>${x.number_plate}</td>
          <td>${x.vehicle_type || ''}</td>
        </tr>
      `).join('');

      async function loadFees(){
        const tx = await authFetch('/u/transactions?kind=fees');
        el('fees').innerHTML = (tx.data || []).map(x => `
          <tr>
            <td>${(x.created_at || '').slice(11,19)}</td>
            <td>${x.matatu_id || ''}</td>
            <td>${x.amount}</td>
          </tr>
        `).join('');
      }

      await loadFees();
      setInterval(loadFees, 10000);
    }
  </script>
</body>
</html>
