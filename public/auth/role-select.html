<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TekeTeke - Choose Role</title>
  <link rel="stylesheet" href="/public/css/dashboard-theme.css"/>
  <script src="/public/js/app-config.js"></script>
  <script src="/public/js/api.js"></script>
  <style>
    .role-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;
    }
    .role-card{
      text-decoration:none;
      color:inherit;
    }
    .role-card .row{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .role-ico{
      width:40px;
      height:40px;
      border-radius:12px;
      display:grid;
      place-items:center;
      background:#eff6ff;
      border:1px solid #dbeafe;
      color:#1d4ed8;
      font-weight:800;
    }
    .role-card h3{
      margin:0;
      font-size:15px;
    }
    .role-card p{
      margin:4px 0 0;
      font-size:13px;
    }
  </style>
</head>
<body>
  <div class="hero-card">
    <div class="hero-stack">
      <p class="eyebrow">TekeTeke</p>
      <h2>Choose your role</h2>
      <p class="muted" style="margin:4px 0 0">Select the console you want to open. Your access follows the permissions on your account.</p>
    </div>
    <div class="hero-actions">
      <span id="auth_state" class="pill">Checking sign-in...</span>
      <a class="btn ghost" href="/public/auth/login.html">Login</a>
      <button id="logoutBtn" class="btn bad" type="button">Logout</button>
    </div>
  </div>

  <section class="panel">
    <div class="role-grid" role="list">
      <a class="card role-card" href="/public/auth/login.html?next=/public/sacco/dashboard.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">SC</div>
          <div>
            <h3>SACCO Admin</h3>
            <p>Manage members, vehicles, transactions, loans and reports.</p>
          </div>
        </div>
      </a>

      <a class="card role-card" href="/public/auth/login.html?next=/public/sacco/staff.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">SS</div>
          <div>
            <h3>SACCO Staff</h3>
            <p>Cash desk: record fees, savings and loan repayments.</p>
          </div>
        </div>
      </a>

      <a class="card role-card" href="/public/auth/login.html?next=/public/matatu/staff.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">MS</div>
          <div>
            <h3>Matatu Staff</h3>
            <p>Trip operations and manual cash entries.</p>
          </div>
        </div>
      </a>

      <a class="card role-card" href="/public/auth/login.html?next=/public/matatu/owner.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">MO</div>
          <div>
            <h3>Matatu Owner</h3>
            <p>View vehicle details, staff and daily transactions.</p>
          </div>
        </div>
      </a>

      <a class="card role-card" href="/public/auth/login.html?next=/public/taxi/index.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">TX</div>
          <div>
            <h3>Taxi</h3>
            <p>Daily cash, expenses and net position.</p>
          </div>
        </div>
      </a>

      <a class="card role-card" href="/public/auth/login.html?next=/public/bodaboda/bodaboda.html" role="listitem">
        <div class="row">
          <div class="role-ico" aria-hidden="true">BB</div>
          <div>
            <h3>BodaBoda</h3>
            <p>Collect cash, track expenses and view totals.</p>
          </div>
        </div>
      </a>
    </div>
  </section>

  <script>
    (async()=>{
      const statusEl = document.getElementById('auth_state');
      const logoutBtn = document.getElementById('logoutBtn');
      const setStatus = (txt)=>{ if(statusEl) statusEl.textContent = txt; };
      try{
        const supa = await window.TT?.getSupabase?.();
        if(!supa){ setStatus('Not configured'); return; }
        const { data:{ session } } = await supa.auth.getSession();
        if(session?.user?.email){ setStatus('Signed in as ' + session.user.email); }
        else{ setStatus('Not signed in'); }
        logoutBtn?.addEventListener('click', async ()=>{
          try{ await supa.auth.signOut(); }catch(_){}
          try{
            if (window.ttClearAuthStorage) window.ttClearAuthStorage();
          }catch(_){}
          location.reload();
        }, { passive:true });
      }catch(e){
        console.warn('[role-select]', e);
        setStatus('Not signed in');
      }
    })();
  </script>
</body>
</html>
