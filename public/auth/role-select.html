<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TekeTeke - Choose Role</title>
  <link rel="stylesheet" href="https://unpkg.com/sanitize.css" />
  <script src="/public/js/app-config.js"></script>
  <script src="/public/js/api.js"></script>
  <style>
    :root{
      --brand:#1976d2;
      --brand-700:#135ba1;
      --bg:#f4f6fb;
      --panel:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --ring:#93c5fd;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-700));display:grid;place-items:center;color:#fff;font-weight:900}
    h1{margin:0;font-size:20px;color:var(--brand)}
    .actions{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-block;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;padding:4px 10px;border-radius:999px;font-size:12px;max-width:40vw;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--brand);background:var(--brand);color:#fff;font-weight:700;cursor:pointer;text-decoration:none;text-align:center}
    .btn.ghost{background:#fff;color:var(--brand)}
    .btn:hover{background:var(--brand-700);border-color:var(--brand-700)}
    .btn.ghost:hover{background:#f0f7ff}
    .lead{margin:6px 0 14px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
    @media(max-width:920px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media(max-width:620px){ .grid{grid-template-columns:1fr} }
    .card{position:relative;display:block;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;text-decoration:none;color:inherit;box-shadow:0 6px 16px rgba(0,0,0,.04);transition:transform .15s ease, box-shadow .15s ease}
    .card:focus{outline:none}
    .card:focus-visible{box-shadow:0 0 0 4px var(--ring);}
    .card:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(0,0,0,.08)}
    .row{display:flex;align-items:center;gap:12px}
    .ico{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;background:#eff6ff;border:1px solid #dbeafe;color:#1d4ed8;font-weight:900}
    .card h2{font-size:16px;margin:0;color:var(--text)}
    .card p{margin:4px 0 0;color:var(--muted);font-size:13px}
    .note{margin-top:16px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand" aria-label="TekeTeke">
        <div class="logo" aria-hidden="true">TT</div>
        <h1>Choose your role</h1>
      </div>
      <div class="actions">
        <span id="auth_state" class="pill">Checking sign-in...</span>
        <a class="btn ghost" href="/public/auth/login.html">Login</a>
        <button id="logoutBtn" class="btn" type="button">Logout</button>
      </div>
    </header>

    <p class="lead">Select the console you want to open. Your access follows the permissions on your account.</p>

    <main class="grid" role="list">
      <a class="card" href="/public/auth/login.html?next=/public/sacco/dashboard.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">SC</div>
          <div>
            <h2>SACCO Admin</h2>
            <p>Manage members, vehicles, transactions, loans and reports.</p>
          </div>
        </div>
      </a>

      <a class="card" href="/public/auth/login.html?next=/public/sacco/staff.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">SS</div>
          <div>
            <h2>SACCO Staff</h2>
            <p>Cash desk: record fees, savings and loan repayments.</p>
          </div>
        </div>
      </a>

      <a class="card" href="/public/auth/login.html?next=/public/matatu/staff.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">MS</div>
          <div>
            <h2>Matatu Staff</h2>
            <p>Trip operations and manual cash entries.</p>
          </div>
        </div>
      </a>

      <a class="card" href="/public/auth/login.html?next=/public/matatu/owner.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">MO</div>
          <div>
            <h2>Matatu Owner</h2>
            <p>View vehicle details, staff and daily transactions.</p>
          </div>
        </div>
      </a>

      <a class="card" href="/public/auth/login.html?next=/public/taxi/index.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">TX</div>
          <div>
            <h2>Taxi</h2>
            <p>Daily cash, expenses and net position.</p>
          </div>
        </div>
      </a>

      <a class="card" href="/public/auth/login.html?next=/public/bodaboda/bodaboda.html" role="listitem">
        <div class="row">
          <div class="ico" aria-hidden="true">BB</div>
          <div>
            <h2>BodaBoda</h2>
            <p>Collect cash, track expenses and view totals.</p>
          </div>
        </div>
      </a>
    </main>
  </div>

  <script>
    (async()=>{
      const statusEl = document.getElementById('auth_state');
      const logoutBtn = document.getElementById('logoutBtn');
      const setStatus = (txt)=>{ if(statusEl) statusEl.textContent = txt; };
      try{
        const supa = await window.TT?.getSupabase?.();
        if(!supa){ setStatus('Not configured'); return; }
        const { data:{ session } } = await supa.auth.getSession();
        if(session?.user?.email){ setStatus('Signed in as ' + session.user.email); }
        else{ setStatus('Not signed in'); }
        logoutBtn?.addEventListener('click', async ()=>{
          try{ await supa.auth.signOut(); }catch(_){}
          ['auth_token','tt_root_token','tt_admin_token'].forEach(k=>localStorage.removeItem(k));
          location.reload();
        }, { passive:true });
      }catch(e){
        console.warn('[role-select]', e);
        setStatus('Not signed in');
      }
    })();
  </script>
</body>
</html>
